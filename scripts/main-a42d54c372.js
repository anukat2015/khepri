var app;!function(e){"use strict";var t=angular.module("app",["http-auth-interceptor","ngStorage","ui.router","ui.bootstrap","ngResize"]);t.config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/"),e.state("main",{url:"/",templateUrl:"partials/main.html",controller:"MainController"}),e.state("configure",{url:"/configure",templateUrl:"partials/configure.html",controller:"ConfigureController"})}])}(app||(app={}));var app;!function(e){"use strict";var t=function(){function e(){}return e}(),n=function(){function e(e){e.config||(e.config=new t,e.config.sparqlEndpoint="http://ldf.fi/ceecs/sparql",e.config.prefixes="\n          PREFIX text: <http://jena.apache.org/text#>\n          PREFIX cs: <http://ldf.fi/ceec-schema#>\n          PREFIX crm: <http://www.cidoc-crm.org/cidoc-crm/>\n          PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>\n        "),this.config=e.config}return e.$inject=["$localStorage"],e.$componentName="configService",e}();angular.module("app").service("configService",n),e.ConfigService=n}(app||(app={}));var app;!function(e){"use strict";var t=function(){function e(){this._queries={}}return Object.defineProperty(e.prototype,"queries",{get:function(){return this._queries},enumerable:!0,configurable:!0}),e.prototype.getQueryState=function(e){return this._queries[e]||(this.queries[e]=new n),this._queries[e]},e}(),n=function(){function e(){this.constraints={}}return e}();e.QueryState=n;var r=function(){function e(e,t){this.constraintString=e,this.order=t}return e}();e.SimpleConstraint=r;var a=function(){function e(e){this.$rootScope=e,this.state=new t}return e.$inject=["$rootScope"],e.$componentName="stateService",e.prototype.setConstraint=function(e,t,n){this.state.getQueryState(e).constraints[t]=n,this.$rootScope.$broadcast("updateConstraint",e,t)},e.prototype.getQueries=function(){return this.state.queries},e.prototype.getQueryState=function(e){return this.state.getQueryState(e)},e.prototype.setQueryState=function(e,t){this.state[e]=t,this.$rootScope.$broadcast("updateConstraint",e)},e.prototype.getConstraintString=function(e,t){void 0===t&&(t={});var n=[];for(var r in this.state.getQueryState(e).constraints)t[r]||(n[this.state.queries[e].constraints[r].order]||(n[this.state.queries[e].constraints[r].order]=""),n[this.state.queries[e].constraints[r].order]+=this.state.queries[e].constraints[r].constraintString);var a="";return n.filter(function(e){return""!==e}).forEach(function(e){return a+=e}),a},e}();angular.module("app").service("stateService",a),e.StateService=a}(app||(app={}));var app;!function(e){"use strict";var t=function(){function e(e,t){this.$http=e,this.$q=t}return e.$inject=["$http","$q"],e.$componentName="sparqlService",e.prototype.check=function(e,t){var n=this.$q.defer();return this.$http(angular.extend({method:"GET",url:e,params:{query:"ASK {}"},headers:{Accept:"application/sparql-results+json"}},t)).then(function(e){return n.resolve(e.data["boolean"]===!0)},function(e){return n.resolve(!1)}),n.promise},e.prototype.checkUpdate=function(e,t){var n=this.$q.defer();return this.$http(angular.extend({method:"POST",url:e,headers:{"Content-Type":"application/sparql-update"},data:"INSERT DATA {}"},t)).then(function(e){return n.resolve(204===e.status)},function(e){return n.resolve(!1)}),n.promise},e.prototype.checkRest=function(e,t){var n=this.$q.defer();return this.$http(angular.extend({method:"POST",url:e+"?default",data:"",headers:{"Content-Type":"text/turtle"}},t)).then(function(e){return n.resolve(204===e.status)},function(e){return n.resolve(!1)}),n.promise},e.prototype.get=function(e,t,n){return this.$http(angular.extend({method:"GET",url:e,params:null!==t?{graph:t}:{"default":""},headers:{Accept:"text/turtle"}},n))},e.prototype.post=function(e,t,n,r){return this.$http(angular.extend({method:"POST",url:e,params:null!=n?{graph:n}:{"default":""},data:t,headers:{"Content-Type":"text/turtle"}},r))},e.prototype.put=function(e,t,n,r){return this.$http(angular.extend({method:"PUT",url:e,params:null!=n?{graph:n}:{"default":""},data:t,headers:{"Content-Type":"text/turtle"}},r))},e.prototype["delete"]=function(e,t,n){return this.$http(angular.extend({method:"DELETE",url:e,params:null!=t?{graph:t}:{"default":""}},n))},e.prototype.query=function(e,t,n){return this.$http(t.length<=2048?angular.extend({method:"GET",url:e,params:{query:t},headers:{Accept:"application/sparql-results+json"}},n):angular.extend({method:"POST",url:e,data:t,headers:{"Content-Type":"application/sparql-query",Accept:"application/sparql-results+json"}},n))},e.prototype.construct=function(e,t,n){return this.$http(t.length<=2048?angular.extend({method:"GET",url:e,params:{query:t},headers:{Accept:"text/turtle"}},n):angular.extend({method:"POST",url:e,data:t,headers:{"Content-Type":"application/sparql-query",Accept:"text/turtle"}},n))},e.prototype.update=function(e,t,n){return this.$http(angular.extend({method:"POST",url:e,headers:{"Content-Type":"application/sparql-update"},data:t},n))},e.prototype.stringToSPARQLString=function(e){return'"'+e.replace(/"/g,'\\"')+'"'},e.prototype.bindingsToObject=function(e){var t={};for(var n in e)t[n]=this.bindingToValue(e[n]);return t},e.prototype.bindingToValue=function(e){if(null==e)return void 0;if("uri"===e.type)return e.value;if("bnode"===e.type)return e.value;if(null!==e.datatype)switch(e.datatype){case"http://www.w3.org/2001/XMLSchema#integer":case"http://www.w3.org/2001/XMLSchema#decimal":return parseInt(e.value,10);case"http://www.w3.org/2001/XMLSchema#float":case"http://www.w3.org/2001/XMLSchema#double":return parseFloat(e.value);case"http://www.w3.org/2001/XMLSchema#boolean":return e.value?!0:!1}return e.value},e.prototype.bindingToString=function(e){if(null==e)return"UNDEF";var t=e.value.replace(/\\/g,"\\\\").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\b]/g,"\\b").replace(/\f/g,"\\f").replace(/\"/g,'\\"').replace(/\'/g,"\\'");if("uri"===e.type)return"<"+t+">";if("bnode"===e.type)return"_:"+t;if(null===e.datatype)return e["xml:lang"]?'"'+t+'"@'+e["xml:lang"]:'"'+t+'"';switch(e.datatype){case"http://www.w3.org/2001/XMLSchema#integer":case"http://www.w3.org/2001/XMLSchema#decimal":case"http://www.w3.org/2001/XMLSchema#double":case"http://www.w3.org/2001/XMLSchema#boolean":return t;case"http://www.w3.org/2001/XMLSchema#string":return'"'+t+'"';default:return'"'+t+'"^^<'+e.datatype+">"}},e}();angular.module("app").service("sparqlService",t),e.SparqlService=t}(app||(app={}));var app;!function(e){"use strict";var t=function(){function e(e,t,n,r){this.constraintString=e,this.sparqlRegex=t,this.jsRegex=n,this.luceneQuery=r,this.order=1}return e}();e.TextSearchConstraint=t;var n=function(){function e(n,r,a,i){var s=this;this.$q=n,this.sparqlService=r,this.configService=a,this.stateService=i,this.restrict="E",this.templateUrl="partials/textsearchview.html",this.scope={viewId:"@",queryId:"="},this.link=function(n,r,a){n.constraints={},n.keywords=[],n.setConstraint=function(e,r){void 0===r&&(r=!1),e?r?(n.constraints={},n.constraints[e]=!0):n.constraints[e]?delete n.constraints[e]:n.constraints[e]=!0:(n.constraints={},Object.keys(n.constraints).length!==n.keywords.length&&n.keywords.forEach(function(e){return n.constraints[e.keyword]=!0}));var a="",i="",o="",l="";if(Object.keys(n.constraints).length>0){for(var c in n.constraints)o+='\\"'+c+'\\" ',a+=c.replace(/ /g,"\\\\s+")+"|",i+=c.replace(/ /g,"\\s+")+"|";o=o.substr(0,o.length-1),a="(?:\\\\b"+a.substr(0,a.length-1)+"\\\\b)",i="(?:\\b"+i.substr(0,i.length-1)+"\\b)",l='\n            ?id text:query "'+o+'" .\n            ?id cs:fulltext ?fulltext .\n            FILTER(REGEX(?fulltext,"'+a+'","i"))\n          '}s.stateService.setConstraint(n.queryId,n.viewId,new t(l,a,i,o))};var i=function(){s.canceler.resolve(),s.canceler=s.$q.defer();var t="+/"+n.query.replace(/ /g,"/ +/").replace(/\*/g,"[^ ]*").replace(/\?/g,"[^ ]?")+"/",r="\\\\b"+n.query.replace(/ /g,"\\\\s+").replace(/\*/g,"\\\\w*").replace(/\?/g,"\\\\w?")+"\\\\b",a={};a[n.viewId]=!0;var i=s.stateService.getConstraintString(n.queryId,a);s.sparqlService.query(s.configService.config.sparqlEndpoint,s.configService.config.prefixes+e.textSearchQuery.replace(/# CONSTRAINTS/g,i).replace(/<LUCENE_REGEX>/g,t).replace(/<SPARQL_REGEX>/g,r),{timeout:s.canceler.promise}).then(function(e){var t=n.keywords,r={};n.keywords=e.data.results.bindings.map(function(e){var t=s.sparqlService.bindingsToObject(e);return r[t.keyword]=!0,t}),t.filter(function(e){return!r[e.keyword]&&n.constraints[e.keyword]}).forEach(function(e){return n.keywords.push(e)})},function(e){return console.log(e)})};n.$on("updateConstraint",function(e,t,r){t===n.queryId&&r!==n.viewId&&n.query&&i()}),n.$watch("query",function(e){e&&i()})},this.canceler=n.defer()}return e.$inject=["$q","sparqlService","configService","stateService"],e.$componentName="textSearchView",e.textSearchQuery='\n      PREFIX text: <http://jena.apache.org/text#>\n      PREFIX cs: <http://ldf.fi/ceec-schema#>\n      SELECT ?keyword (COUNT(?tid) AS ?totalInstances) (COUNT(?id) AS ?matchingInstances) {\n        {\n          ?tid text:query "<LUCENE_REGEX>" .\n          ?tid a cs:Letter .\n          ?tid cs:fulltext ?fulltext .\n          FILTER(REGEX(?fulltext, "<SPARQL_REGEX>", "i"))\n          BIND(LCASE(REPLACE(REPLACE(?fulltext, ".*?(<SPARQL_REGEX>).*", "$1", "si"),"\\\\s+"," ")) AS ?keyword)\n        } UNION {\n          ?id text:query "<LUCENE_REGEX>" .\n          ?id a cs:Letter .\n          ?id cs:fulltext ?fulltext .\n          FILTER(REGEX(?fulltext, "<SPARQL_REGEX>", "i"))\n          # CONSTRAINTS\n          BIND(LCASE(REPLACE(REPLACE(?fulltext, ".*?(<SPARQL_REGEX>).*", "$1", "si"),"\\\\s+"," ")) AS ?keyword)\n        }\n      }\n      GROUP BY ?keyword\n      ORDER BY DESC(?matchingInstances)\n    ',e}();angular.module("app").directive("textSearchView",["$q","sparqlService","configService","stateService",function(){return new(Function.prototype.bind.apply(n,[null].concat(Array.prototype.slice.call(arguments))))}]),e.TextSearchViewDirective=n}(app||(app={}));var app;!function(e){"use strict";var t=function(){function e(e,t,n){this.before=e,this.match=t,this.after=n}return e}(),n=function(){function e(e,t,n,r,a,i){this.id=e,this.label=t,this.fulltext=n,this.snippet=r,this.metadata=a,this.filtered=i}return e}(),r=function(){function r(a,i,s,o,l,c){var u=this;this.$timeout=a,this.$q=i,this.$sce=s,this.sparqlService=o,this.configService=l,this.stateService=c,this.restrict="E",this.templateUrl="partials/resultlistview.html",this.scope={width:"=",viewId:"@",showMetadata:"=",queryId:"="},this.link=function(a,i,s){a.orderBy="match",a.orderByDescending=!1;var o=function(){var i="(?:",s=u.stateService.getQueryState(a.queryId).constraints;for(var o in s)s[o]instanceof e.TextSearchConstraint&&(i+=s[o].sparqlRegex+"|");"|"===i.charAt(i.length-1)&&(i=i.substring(0,i.length-1)),i+=")";var l={};l[a.viewId]=!0;var c=u.stateService.getConstraintString(a.queryId,l);u.canceler.resolve(),u.canceler=u.$q.defer(),u.sparqlService.query(u.configService.config.sparqlEndpoint,u.configService.config.prefixes+r.resultQuery.replace(/# CONSTRAINTS/g,c).replace(/<SPARQL_REGEX>/g,i).replace(/<ORDER_BY>/g,a.orderByDescending?"DESC(?"+a.orderBy+")":"?"+a.orderBy)).then(function(e){a.metadataKeys=[],a.showMetadata&&e.data.head.vars.forEach(function(e){"metadata"===e.substring(0,8)&&a.metadataKeys.push(e.substring(8))}),a.results=e.data.results.bindings.map(function(e){var r=void 0,i=[];a.metadataKeys.forEach(function(t){return i.push(e["metadata"+t].value)});var s=document.createElement("div");s.textContent=e.fulltext.value,r=s.innerHTML;var o;if(e.match){var l,c,p,d=new RegExp("("+e.match.value+")"),g=r.split(d);r="";for(var h=0;h<g.length;h+=2)l=c,g[h].length>a.width?(p=g[h].substring(0,a.width),c=g[h].substring(g[h].length-a.width)):(p=g[h],c=g[h]),r+=g[h].length>1e3?g[h].substring(0,500)+'<span class="red">...</span>'+g[h].substring(g[h].length-500):g[h],r+='<span class="blue">',g.length>h+1&&(r+=g[h+1]),r+="</span>";o=new t(u.$sce.trustAsHtml(l),e.match.value,u.$sce.trustAsHtml(p))}return r=u.$sce.trustAsHtml(r),new n(e.id.value,e.label.value,r,o,i,u.filtered[e.id.value])})},function(e){return console.log(e)})};a.setOrderBy=function(e){a.orderBy===e?a.orderByDescending=!a.orderByDescending:(a.orderBy=e,a.orderByDescending=!1),o()},a.filter=function(t,n){if(n)window.open(t.id,"_blank");else{t.filtered=!t.filtered,u.filtered[t.id]=t.filtered;var r="FILTER (";for(var i in u.filtered)u.filtered[i]&&(r+="?id!=<"+i+"> && ");r=r.substr(0,r.length-4)+")","FILT)"===r&&(r=""),u.stateService.setConstraint(a.queryId,a.viewId,new e.SimpleConstraint(r,2))}},a.$watch("width",function(e,t){e&&o()}),a.$on("updateConstraint",function(e,t,n){t===a.queryId&&n!==a.viewId&&o()})},this.filtered={},this.canceler=i.defer()}return r.$inject=["$timeout","$q","$sce","sparqlService","configService","stateService"],r.$componentName="resultListView",r.resultQuery='\n      PREFIX skos: <http://www.w3.org/2004/02/skos/core#>\n      PREFIX crm: <http://www.cidoc-crm.org/cidoc-crm/>\n      PREFIX cs: <http://ldf.fi/ceec-schema#>\n      SELECT ?id ?label ?fulltext ?match ?metadataAuthor ?metadataYear {\n        {\n          SELECT DISTINCT ?id {\n            # CONSTRAINTS\n          }\n        }\n        ?id skos:prefLabel ?label .\n        ?id cs:fulltext ?fulltext .\n        ?id crm:P28_custody_surrendered_by/skos:prefLabel ?metadataAuthor .\n        ?id cs:year ?metadataYear .\n        OPTIONAL {\n          FILTER("<SPARQL_REGEX>"!="(?:)")\n          ?id cs:fulltext ?fulltext .\n          FILTER REGEX(?fulltext,"<SPARQL_REGEX>","si")\n          BIND(REPLACE(?fulltext,".*?(<SPARQL_REGEX>).*","$1","si") AS ?match)\n        }\n      }\n      ORDER BY <ORDER_BY>\n      LIMIT 50\n    ',r}();angular.module("app").directive("resultListView",["$timeout","$q","$sce","sparqlService","configService","stateService",function(){return new(Function.prototype.bind.apply(r,[null].concat(Array.prototype.slice.call(arguments))))}]),e.ResultListViewDirective=r}(app||(app={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},app;!function(e){"use strict";var t=function(){function e(){this.restrict="E",this.templateUrl="partials/treeview.html"}return e}(),n=function(){function e(e,t,n){this.id=e,this.label=t,this.instances=n,this.children=[],this.matchingInstances=n}return e}(),r=function(){function e(e,t){this.constraintString=e,this.values=t,this.order=5}return e.prototype.clone=function(){return new e(this.constraintString,this.values.slice())},e}(),a=function(e){function t(a,i,s,o){var l=this;e.call(this),this.$q=a,this.configService=i,this.stateService=s,this.sparqlService=o,this.scope={viewId:"@",queryId:"="},this.updateCounts=function(e,t){e.matchingInstances=t[e.id]?t[e.id]:0,e.children.forEach(function(e){return l.updateCounts(e,t)})},this.link=function(e,a,i){e.constraints=[],e.selectElement=function(t,n){void 0===n&&(n=!1),n?e.constraints.push(t):e.constraints=[t];var a="";e.constraints.forEach(function(e){a+="{ ?id crm:P28_custody_surrendered_by/cs:education/rdfs:subClassOf* <"+e.id+"> } UNION"}),a=a.substr(0,a.length-6),l.stateService.setConstraint(e.queryId,e.viewId,new r(a,e.constraints))},e.isSelected=function(t){return-1!=e.constraints.indexOf(t)},l.sparqlService.query(l.configService.config.sparqlEndpoint,t.getClassTreeQuery).then(function(t){var r={},a={};t.data.results.bindings.forEach(function(e){if(e.subClass){var t=e.subClass.value;r[t]||(r[t]={}),r[t][e.superClass.value]=!0}else a[e["class"].value]=new n(e["class"].value,e.classLabel.value,parseInt(e.instances.value))}),e.tree=[];for(var i in a)if(r[i])for(var s in r[i])a[s].children.push(a[i]);else e.tree.push(a[i])},function(e){return console.log(e)}),e.$on("updateConstraint",function(n,r,a){l.canceler.resolve();var i="";for(var s in a)a[s].keywords&&a[s].keywords.forEach(function(e){return i+=l.sparqlService.stringToSPARQLString(e)});l.sparqlService.query(l.configService.config.sparqlEndpoint,l.configService.config.prefixes+t.getClassCountsQuery.replace(/# CONSTRAINTS/g,r)).then(function(t){var n={};t.data.results.bindings.forEach(function(e){return n[e["class"].value]=parseInt(e.instances.value)}),e.tree.forEach(function(e){return l.updateCounts(e,n)})},function(e){return console.log(e)})})},this.canceler=a.defer()}return __extends(t,e),t.$inject=["$q","configService","stateService","sparqlService"],t.$componentName="classTreeView",t.getClassTreeQuery="\n      PREFIX skos: <http://www.w3.org/2004/02/skos/core#>\n      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n      PREFIX cs: <http://ldf.fi/ceec-schema#>\n      SELECT ?subClass ?superClass ?class ?classLabel ?instances {\n        {\n          ?subClass rdfs:subClassOf ?superClass .\n          FILTER EXISTS {\n            ?p cs:education/rdfs:subClassOf* ?subClass .\n          }\n        } UNION {\n          {\n            SELECT ?class (COUNT(DISTINCT ?p) AS ?instances) {\n              ?p cs:education/rdfs:subClassOf* ?class .\n            }\n            GROUP BY ?class\n          }\n          ?class rdfs:label|skos:prefLabel ?classLabel .\n        }\n      }\n    ",t.getClassCountsQuery="\n      PREFIX crm: <http://www.cidoc-crm.org/cidoc-crm/>\n      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n      PREFIX cs: <http://ldf.fi/ceec-schema#>\n      SELECT ?class (COUNT(DISTINCT ?p) AS ?instances) {\n        # CONSTRAINTS\n        ?id crm:P28_custody_surrendered_by ?p .\n        ?p cs:education/rdfs:subClassOf* ?class .\n      }\n      GROUP BY ?class\n    ",t}(t);angular.module("app").directive("classTreeView",["$q","configService","stateService","sparqlService",function(){return new(Function.prototype.bind.apply(a,[null].concat(Array.prototype.slice.call(arguments))))}]),e.ClassTreeViewDirective=a}(app||(app={}));var app;!function(e){"use strict";var t=function(){function e(){}return e}();e.ChartDefinition=t;var n=function(){function e(e){this.resize=e,this.restrict="E",this.template='<div style="width:100%"></div>',this.scope={chartDefinition:"="},this.link=function(e,t,n){var r=new google.visualization.ChartWrapper({chartType:e.chartDefinition.type,options:e.chartDefinition.options,dataTable:e.chartDefinition.dataTable});e.$watch("chartDefinition.dataTable",function(n,a){n!==a&&(r.setChartType(e.chartDefinition.type),r.setOptions(e.chartDefinition.options),r.setDataTable(e.chartDefinition.dataTable),r.draw(t[0].children[0]))}),e.$on("resize",function(){e.chartDefinition.dataTable&&r.draw(t[0].children[0])}),google.visualization.events.addListener(r,"select",function(){return e.chartDefinition.select(r.getChart().getSelection(),e.chartDefinition,r)}),e.chartDefinition.dataTable&&r.draw(t[0].children[0])}}return e.$inject=["resize"],e.$componentName="googleChartView",e}();angular.module("app").directive("googleChartView",["resize",function(){return new(Function.prototype.bind.apply(n,[null].concat(Array.prototype.slice.call(arguments))))}]),e.GoogleChartViewDirective=n}(app||(app={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},app;!function(e){"use strict";var t=function(){function e(){this.matchesByYearAndQueryAndGroupAndAggregation={},this.totalsByYearAndGroupAndAggregation={},this.queries={},this.groups={},this.groupsByAggregation={},this.minYear=Number.MAX_VALUE,this.maxYear=Number.MIN_VALUE}return e}(),n=function(e){function t(t,n){e.call(this),this.queryId=t,this.select=n}return __extends(t,e),t}(e.ChartDefinition),r=function(){function e(e,t){this.id=e,this.label=t}return e}(),a=function(){function a(t,i,s){var o=this;this.sparqlService=t,this.configService=i,this.stateService=s,this.restrict="E",this.templateUrl="partials/multigooglechartviews.html",this.scope={viewId:"@",queries:"="},this.link=function(t,i,s){t.avgType="total",t.movingSpan=20,t.graphType="individual",t.bootstraps=1,t.selectedGrouping=null,o.sparqlService.query(o.configService.config.sparqlEndpoint,a.propertiesQuery).then(function(e){return t.availableGroupings=e.data.results.bindings.map(function(e){return new r(e.property.value,e.propertyLabel.value)})},function(e){return console.log(e)});var l=function(n,r,a){var i;if(0!==n.length){var s=r.dataTable.getValue(n[0].row,0);i="?id cs:year ?year . FILTER (STRDT(?year,xsd:integer)>"+(s-t.movingSpan/2)+" && STRDT(?year,xsd:integer)<"+(s+t.movingSpan/2)+") ";var l=r.dataTable.getColumnId(n[0].column);l&&(i+="?id crm:P28_custody_surrendered_by/<"+t.selectedGrouping.id+"> <"+l+"> .")}else i="";o.stateService.setConstraint(r.queryId,t.viewId,new e.SimpleConstraint(i,2))},c=function(){var r=a.graphQuery.split(/[\{\}] # \/?CONSTRAINTHOLDER/),i=r[0];t.queries.forEach(function(n){var a="(?:",s=o.stateService.getQueryState(n.name).constraints;for(var l in s)s[l]instanceof e.TextSearchConstraint&&(a+=s[l].sparqlRegex+"|");"|"===a.charAt(a.length-1)&&(a=a.substring(0,a.length-1)),a+=")","(?:)"===a&&(a="^$");var c={};c[t.viewId]=!0;var u=o.stateService.getConstraintString(n.name,c);i+="{"+r[1].replace(/<QUERY_ID>/g,o.sparqlService.stringToSPARQLString(n.name)).replace(/# CONSTRAINTS/g,u).replace(/<REGEX>/g,o.sparqlService.stringToSPARQLString(a))+"} UNION"}),i=i.substring(0,i.length-6)+r[2];var s,c=t.selectedGrouping?"?id crm:P28_custody_surrendered_by/<"+t.selectedGrouping.id+"> ?group . ?group skos:prefLabel ?l . FILTER (LANG(?l) = 'en' || LANG(?l) = '')":"";switch(t.avgType){case"total":s="";break;case"text":s="BIND(?id AS ?aggrId)";break;case"author":s="?id crm:P28_custody_surrendered_by ?aggrId .";break;default:throw"Unknown avgType "+t.avgType}i=o.configService.config.prefixes+i.replace(/# AGGREGATION/g,s).replace(/# GROUPING/g,c),o.sparqlService.query(o.configService.config.sparqlEndpoint,i).then(function(e){var r=a.processData(e.data.results.bindings),i={};t.charts.forEach(function(e){return i[e.queryId]=e}),"scattercomparison"===t.graphType?i.scatterComparison||(t.charts=[new n("scatterComparison",l)]):t.charts=t.separateGroups||"areacomparison"===t.graphType?Object.keys(r.groups).map(function(e){return i[e]?i[e]:new n(e,l)}):t.queries.map(function(e){return i[e.name]?i[e.name]:new n(e.name,l)});var s,o,c,u,p=[],d=[];if("scattercomparison"===t.graphType)c=["Scatterplot"];else if(t.separateGroups||"areacomparison"===t.graphType){s=r.groups,c=[];for(var g in r.groups)c.push(r.groups[g]);o=r.queries,u=Object.keys(r.queries)}else{s=r.queries,c=Object.keys(r.queries),o=r.groups,u=[];for(var g in r.groups)u.push(r.groups[g])}t.charts.forEach(function(e,n){switch(e.dataTable=new google.visualization.DataTable,t.graphType){case"areacomparison":e.type="AreaChart";break;case"individual":e.type="LineChart";break;case"scattercomparison":e.type="MotionChart";break;default:throw"Unknown graphType "+t.graphType}var r={};"scattercomparison"===t.graphType&&e.dataTable.addColumn("string","id"),e.dataTable.addColumn("number","year");var a=0;"scattercomparison"!==t.graphType?u.forEach(function(n,i){e.dataTable.addColumn({id:o[i],label:n,type:"number"}),t.accumulation||(e.dataTable.addColumn({id:o[i],label:n,role:"interval",type:"number"}),e.dataTable.addColumn({id:o[i],label:n,role:"interval",type:"number"}),e.dataTable.addColumn({id:o[i],label:n,role:"interval",type:"number"}),e.dataTable.addColumn({id:o[i],label:n,role:"interval",type:"number"}),e.dataTable.addColumn({id:o[i],label:n,role:"interval",type:"number"}),e.dataTable.addColumn({id:o[i],label:n,role:"interval",type:"number"})),r[a++]={targetAxisIndex:0},"individual"!==t.graphType||!t.accumulation&&t.hideTotals||(e.dataTable.addColumn({id:o[i],label:n+" total",type:"number"}),r[a++]={targetAxisIndex:t.accumulation?0:1,lineWidth:1,lineDashStyle:[5,5],visibleInLegend:!1})}):(e.dataTable.addColumn("number","percentage of "+t.queries[1].name),e.dataTable.addColumn("number","total number of matches"),e.dataTable.addColumn("string",t.selectedGrouping?t.selectedGrouping.label:"matching")),e.options={title:c[n],explorer:{keepInBounds:!0,maxZoomOut:1},theme:"material",isStacked:"percent",hAxis:{title:"year",format:"#"},intervals:{style:"line"},series:r,vAxes:{0:{title:t.accumulation?"Percent":"Matches/million",minValue:0,maxValue:"areacomparison"===t.graphType?1:10},1:{title:"Count",gridlines:{color:"none"},minValue:0,logScale:!0}}},p[n]={},d[n]={}});var h=[];h.length=c.length;for(var f=0;f<h.length;f++)h[f]=[];for(var m=t.accumulation&&"individual"===t.graphType?0:Math.floor(t.movingSpan/2),v=r.minYear;v<=r.maxYear;v++){var y=0;if("scattercomparison"===t.graphType){var b={},w={};for(var S in r.queries)for(var A in r.groups)for(var f=v-m;v+m>=f;f++)if(r.totalsByYearAndGroupAndAggregation[f]&&r.matchesByYearAndQueryAndGroupAndAggregation[f]&&r.matchesByYearAndQueryAndGroupAndAggregation[f][S]&&r.matchesByYearAndQueryAndGroupAndAggregation[f][S][A])for(var E in r.matchesByYearAndQueryAndGroupAndAggregation[f][S][A])w[E]=!0,b[E]||(b[E]={}),b[E][S]?b[E][S]+=r.matchesByYearAndQueryAndGroupAndAggregation[f][S][A][E]:b[E][S]=r.matchesByYearAndQueryAndGroupAndAggregation[f][S][A][E];var T=Object.keys(r.queries);for(var I in w){var C=[I,v,100*b[I][T[1]]/(b[I][T[1]]+b[I][T[0]]),b[I][T[0]]+b[I][T[1]]];for(var g in r.groupsByAggregation[I]){var q=C.slice();q.push(g),h[0].push(q)}}}else for(var x in s){var C=[];C.push(v);for(var R in o){var S=void 0,A=void 0;t.separateGroups||"areacomparison"===t.graphType?(S=R,A=x):(S=x,A=R);for(var $=[],k=[],G=[],L=0;L<t.bootstraps;L++)G[L]=0,k[L]={},$[L]={};for(var f=v-m;v+m>=f;f++)if(r.totalsByYearAndGroupAndAggregation[f]&&r.totalsByYearAndGroupAndAggregation[f][A])for(var L=0;L<t.bootstraps;L++){var N=Object.keys(r.totalsByYearAndGroupAndAggregation[f][A]),w=[];if(1===t.bootstraps)w=N;else for(var O=0;O<N.length;O++)w[O]=N[Math.floor(Math.random()*N.length)];if(r.matchesByYearAndQueryAndGroupAndAggregation[f]&&r.matchesByYearAndQueryAndGroupAndAggregation[f][S]&&r.matchesByYearAndQueryAndGroupAndAggregation[f][S][A])for(var P=0;P<w.length;P++){var E=w[P];r.matchesByYearAndQueryAndGroupAndAggregation[f][S][A][E]&&($[L][E]?$[L][E]+=r.matchesByYearAndQueryAndGroupAndAggregation[f][S][A][E]:$[L][E]=r.matchesByYearAndQueryAndGroupAndAggregation[f][S][A][E])}if(r.totalsByYearAndGroupAndAggregation[f][A])for(var P=0;P<w.length;P++){var E=w[P];k[L][E]?k[L][E]+=r.totalsByYearAndGroupAndAggregation[f][A][E]:k[L][E]=r.totalsByYearAndGroupAndAggregation[f][A][E],G[L]+=r.totalsByYearAndGroupAndAggregation[f][A][E]}}for(var B=[],L=0;L<t.bootstraps;L++){B[L]=0;for(var E in k[L])k[L][E]&&(B[L]+=1e6*($[L][E]?$[L][E]:0)/k[L][E])}if(B.sort(function(e,t){return e-t}),t.accumulation&&"individual"===t.graphType){d[y][A]||(d[y][A]=0,p[y][A]=0);var Q=Math.floor(t.bootstraps/2);p[y][A]+=0!==Object.keys(k[Q]).length?B[Q]/Object.keys(k[Q]).length:0,d[y][A]+=G[Math.floor(t.bootstraps/2)],C.push(p[y][A]),C.push(d[y][A])}else{if(0!==Object.keys(k).length){var Q=Math.floor(t.bootstraps/2);C.push(B[Q]/Object.keys(k[Q]).length),Q=Math.floor(t.bootstraps/100),C.push(B[Q]/Object.keys(k[Q]).length),Q=Math.floor(t.bootstraps/20),C.push(B[Q]/Object.keys(k[Q]).length),Q=Math.floor(t.bootstraps/10),C.push(B[Q]/Object.keys(k[Q]).length),Q=t.bootstraps-1-Math.floor(t.bootstraps/10),C.push(B[Q]/Object.keys(k[Q]).length),Q=t.bootstraps-1-Math.floor(t.bootstraps/20),C.push(B[Q]/Object.keys(k[Q]).length),Q=t.bootstraps-1-Math.floor(t.bootstraps/100),C.push(B[Q]/Object.keys(k[Q]).length)}else C.push(0),C.push(0),C.push(0),C.push(0),C.push(0),C.push(0),C.push(0);t.hideTotals||"individual"!==t.graphType||C.push(G[Math.floor(t.bootstraps/2)])}}h[y++].push(C)}}t.accumulation&&"individual"===t.graphType&&h.forEach(function(e,t){return e.forEach(function(e){var n=1;Object.keys(r.groups).forEach(function(r){e[n]=100*e[n++]/p[t][r],e[n]=100*e[n++]/d[t][r]})})}),h.forEach(function(e,n){return t.charts[n].dataTable.addRows(e)})},function(e){return console.log(e)})};t.$watchCollection("[selectedGrouping, graphType, movingSpan, hideTotals, avgType, separateGroups, accumulation, bootstraps]",function(e,t){e!==t&&c()}),t.$on("updateConstraint",function(e,n,r){r!==t.viewId&&c()}),t.charts=[],t.$watch(function(){return t.queries.map(function(e){return e.name})},function(e,t){c()},!0),t.$watchCollection("queries",function(e,t){e!==t&&c()}),c()}}return a.$inject=["sparqlService","configService","stateService"],a.$componentName="multiGoogleChartViews",a.processData=function(e){for(var n=new t,r=0;!e[r].queryId;){var a=e[r++],i=parseInt(a.year.value,10);i>n.maxYear&&(n.maxYear=i),i<n.minYear&&(n.minYear=i),n.totalsByYearAndGroupAndAggregation[i]||(n.totalsByYearAndGroupAndAggregation[i]={});var s=a.group?a.group.value:"matching";n.totalsByYearAndGroupAndAggregation[i][s]||(n.totalsByYearAndGroupAndAggregation[i][s]={});var o=a.aggrId?a.aggrId.value:"";n.groupsByAggregation[o]||(n.groupsByAggregation[o]={}),n.groupsByAggregation[o][s]=!0,n.totalsByYearAndGroupAndAggregation[i][s][o]=parseInt(a.total.value,10),n.groups[s]=a.groupLabel?a.groupLabel.value:s}for(;r<e.length;){var a=e[r++],i=parseInt(a.year.value,10);n.matchesByYearAndQueryAndGroupAndAggregation[i]||(n.matchesByYearAndQueryAndGroupAndAggregation[i]={});var l=a.queryId.value;n.matchesByYearAndQueryAndGroupAndAggregation[i][l]||(n.matchesByYearAndQueryAndGroupAndAggregation[i][l]={});var s=a.group?a.group.value:"matching";n.matchesByYearAndQueryAndGroupAndAggregation[i][l][s]||(n.matchesByYearAndQueryAndGroupAndAggregation[i][l][s]={}),n.queries[l]=!0;var o=a.aggrId?a.aggrId.value:"";n.matchesByYearAndQueryAndGroupAndAggregation[i][l][s][o]=parseInt(a.matching.value,10)}return n},a.propertiesQuery="\n      PREFIX crm: <http://www.cidoc-crm.org/cidoc-crm/>\n      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n      PREFIX skos: <http://www.w3.org/2004/02/skos/core#>\n      SELECT ?property (SAMPLE(?l) AS ?propertyLabel) {\n        {\n          SELECT DISTINCT ?property {\n            ?id crm:P28_custody_surrendered_by ?person .\n            ?person ?property ?object .\n            FILTER isIRI(?object)\n          }\n        }\n        ?property skos:prefLabel|rdfs:label ?l .\n        FILTER (LANG(?l) = 'en' || LANG(?l) = '')\n      }\n      GROUP BY ?property\n    ",a.graphQuery="\n      PREFIX cs: <http://ldf.fi/ceec-schema#>\n      PREFIX crm: <http://www.cidoc-crm.org/cidoc-crm/>\n      PREFIX skos: <http://www.w3.org/2004/02/skos/core#>\n      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>\n      PREFIX pf: <http://jena.hpl.hp.com/ARQ/property#>\n      SELECT ?queryId ?group (SAMPLE(?l2) AS ?groupLabel) ?aggrId ?year (MAX(?mwords) AS ?matching) (MAX(?twords) as ?total) {\n        {\n          {\n            SELECT ?queryId ?group (SAMPLE(?l) AS ?l2) ?aggrId ?year ((COUNT(?foo)-COUNT(DISTINCT ?id)) AS ?mwords) {\n              { # CONSTRAINTHOLDER\n                # CONSTRAINTS\n                BIND(<REGEX> AS ?regex)\n                BIND(<QUERY_ID> AS ?queryId)\n              } # /CONSTRAINTHOLDER\n              ?id cs:year ?year .\n              ?id cs:fulltext ?fulltext .\n              ?foo pf:strSplit (?fulltext ?regex) .\n              # AGGREGATION\n              # GROUPING\n            }\n            GROUP BY ?queryId ?group ?aggrId ?year\n          }\n        } UNION {\n          {\n            SELECT ?group (SAMPLE(?l) AS ?l2) ?aggrId ?year (SUM(STRDT(?wc, xsd:integer)) AS ?twords) {\n              ?id a cs:Letter .\n              ?id cs:year ?year .\n              ?id cs:wordcount ?wc .\n              # AGGREGATION\n              # GROUPING\n            }\n            GROUP BY ?group ?aggrId ?year\n          }\n        }\n      }\n      GROUP BY ?queryId ?group ?year ?aggrId\n      ORDER BY ?queryId ?group ?year\n    ",a}();angular.module("app").directive("multiGoogleChartViews",["sparqlService","configService","stateService",function(){
return new(Function.prototype.bind.apply(a,[null].concat(Array.prototype.slice.call(arguments))))}]),e.MultiGoogleChartViewsDirective=a}(app||(app={}));var app;!function(e){"use strict";var t=function(){function e(e){this.name=e,this.active=!1}return e}();e.Query=t;var n=function(){function e(e,n,r){this.$scope=e,this.stateService=n,this.$timeout=r,e.queries=[],e.state="normal",n.getQueryState("unnamed 1"),e.queries.push(new t("unnamed 1")),e.queries[0].active=!0;var a=2;e.addQuery=function(){var r="unnamed "+a++;n.getQueryState(r);var i=new t(r);i.active=!0,e.queries.push(i)},e.renameQuery=function(e,t){n.getQueries()[t]=n.getQueries()[e.name],delete n.getQueries[e.name],e.name=t},e.removeQuery=function(t){delete n.getQueries[t.name],e.queries.splice(e.queries.indexOf(t),1)},e.resize=function(){return r(function(){return e.$broadcast("resize")})}}return e.$inject=["$scope","stateService","$timeout"],e.$componentName="MainController",e}();angular.module("app").controller("MainController",n),e.MainController=n}(app||(app={})),function(e){try{e=angular.module("app")}catch(t){e=angular.module("app",[])}e.run(["$templateCache",function(e){e.put("partials/main.html",'\n<div class="container-fluid">\n  <div class="row">\n    <uib-tabset ng-class="state==\'filter\' ? \'col-xs-12\' : (state==\'visualization\' ? \'col-xs-4\': \'col-xs-8\')">\n      <uib-tab ng-repeat="query in queries" active="query.active">\n        <uib-tab-heading><span ng-show="!editingName" ng-click="query.active &amp;&amp; (editingName=true)">{{query.name}}</span>\n          <input ng-show="editingName" ng-model="newName" ng-init="newName=query.name" ng-blur="renameQuery(query,newName)" ng-keyup="($event.keyCode == 13 &amp;&amp; (renameQuery(query,newName) || true) &amp;&amp; (editingName=false)) || ($event.keyCode == 27 &amp;&amp; (editingName=false))"/><span ng-show="query.active" ng-click="removeQuery(query)" class="glyphicon glyphicon-remove"></span>\n        </uib-tab-heading>\n        <div class="container-fluid">\n          <div class="row">\n            <div ng-class="state==\'filter\' ? \'col-xs-2\' : (state==\'visualization\' ? \'col-xs-12\' : \'col-xs-3\')">\n              <h4>Constrain</h4>\n              <text-search-view view-id="text-search-view" query-id="query.name"></text-search-view>\n            </div>\n            <div ng-class="state==\'filter\' ? \'col-xs-10\' : \'col-xs-9\'" ng-show="state!=\'visualization\'">\n              <h4>Filter\n                <button ng-click="$parent.$parent.$parent.state= $parent.$parent.$parent.state==\'filter\' ? \'normal\' : \'filter\'" class="btn btn-sm btn-default"><span class="glyphicon glyphicon-resize-horizontal"></span></button>\n              </h4>\n              <result-list-view width="state==\'filter\' ? 60 : 30" show-metadata="state==\'filter\'" view-id="result-list-view" query-id="query.name"></result-list-view>\n            </div>\n          </div>\n        </div>\n      </uib-tab>\n      <uib-tab select="addQuery()">\n        <uib-tab-heading><span class="glyphicon glyphicon-plus"></span></uib-tab-heading>\n      </uib-tab>\n    </uib-tabset>\n    <div ng-class="state==\'visualization\' ? \'col-xs-8\' : \'col-xs-4\'" ng-show="state!=\'filter\'">\n      <h4>View\n        <button ng-click="state= state==\'visualization\' ? \'normal\' : \'visualization\';resize()" class="btn btn-sm btn-default"><span class="glyphicon glyphicon-resize-horizontal"></span></button>\n      </h4>\n      <multi-google-chart-views view-id="google-chart-view" queries="queries"></multi-google-chart-views>\n    </div>\n  </div>\n</div>')}])}(),function(e){try{e=angular.module("app")}catch(t){e=angular.module("app",[])}e.run(["$templateCache",function(e){e.put("partials/multigooglechartviews.html",'\n<google-chart-view ng-repeat="chart in charts" chart-definition="chart"></google-chart-view>\n<div class="form-horizontal">\n  <div class="form-group"> \n    <label>Partition:</label>\n    <select ng-model="selectedGrouping" ng-options="availableGrouping.label for availableGrouping in availableGroupings" class="form-control">\n      <option value="">total</option>\n    </select>\n  </div>\n  <div class="form-group">\n    <label>Sample length (years):</label>\n    <input type="text" ng-model="movingSpan" class="form-control"/>\n  </div>\n  <div class="form-group">\n    <label>Graph type:</label>\n    <div class="btn-group">\n      <label ng-model="graphType" uib-btn-radio="\'individual\'" class="btn btn-sm btn-success">individual</label>\n      <label ng-model="graphType" uib-btn-radio="\'areacomparison\'" ng-disabled="queries.length &lt; 2" class="btn btn-sm btn-success">compare as area</label>\n      <label ng-model="graphType" uib-btn-radio="\'scattercomparison\'" ng-disabled="queries.length !== 2" class="btn btn-sm btn-success">compare as scatterplot</label>\n    </div>\n  </div>\n</div>\n<div ng-show="graphType == \'individual\'" class="form-inline">\n  <div class="checkbox">\n    <label> \n      <input type="checkbox" ng-model="hideTotals" ng-disabled="accumulation"/>\n    </label>&nbsp;Hide totals\n  </div>\n  <div class="checkbox">\n    <label> \n      <input type="checkbox" ng-model="accumulation"/>\n    </label>&nbsp;Show as accumulation chart\n  </div>\n  <div ng-show="selectedGrouping!=\'\'" class="checkbox">\n    <label> \n      <input type="checkbox" ng-model="separateGroups"/>\n    </label>&nbsp;Partitions as charts\n  </div>\n</div>\n<div class="form-horizontal"> \n  <div class="form-group">\n    <label>Calculate values as:</label>\n    <div class="btn-group">\n      <label ng-model="avgType" uib-btn-radio="\'total\'" class="btn btn-sm btn-primary">total</label>\n      <label ng-model="avgType" uib-btn-radio="\'text\'" class="btn btn-sm btn-primary">text average</label>\n      <label ng-model="avgType" uib-btn-radio="\'author\'" class="btn btn-sm btn-primary">author average</label>\n    </div>\n  </div>\n  <div class="form-group">\n    <label>Number of bootstraps:</label>\n    <input type="text" ng-model="bootstraps" ng-model-options="{updateOn : \'change blur\'}" ng-disabled="avgType === \'total\'" class="form-control"/>\n  </div>\n</div>')}])}(),function(e){try{e=angular.module("app")}catch(t){e=angular.module("app",[])}e.run(["$templateCache",function(e){e.put("partials/resultlistview.html",'\n<script type="text/ng-template" id="popover.html">\n  <div ng-bind-html="result.fulltext" class="small black"></div>\n</script>\n<table infinite-scroll="scrollInstances()" infinite-scroll-parent="infinite-scroll-parent" infinite-scroll-distance="5">\n  <tr class="item selected">\n    <th colspan="3" ng-click="setOrderBy(\'match\')">Context <span ng-show="orderBy==\'match\' &amp;&amp; !orderByDescending" class="glyphicon glyphicon-triangle-top"></span><span ng-show="orderBy==\'match\' &amp;&amp; orderByDescending" class="glyphicon glyphicon-triangle-bottom"></span></th>\n    <th ng-repeat="key in metadataKeys" ng-click="setOrderBy(\'metadata\'+key)">{{::key}} <span ng-show="orderBy==\'metadata\'+key &amp;&amp; !orderByDescending" class="glyphicon glyphicon-triangle-top"></span><span ng-show="orderBy==\'metadata\'+key &amp;&amp; orderByDescending" class="glyphicon glyphicon-triangle-bottom"></span></th>\n  </tr>\n  <tr ng-repeat="result in results" ng-click="filter(result,$event.ctrlKey||$event.metaKey)" ng-style="result.filtered ? {\'text-decoration\': \'line-through\'} : {}" uib-popover-template="\'popover.html\'" popover-trigger="mouseenter" popover-title="{{result.label}}" popover-placement="bottom" class="item selected">\n    <td ng-if="result.snippet" ng-bind-html="result.snippet.before" class="text-right"> </td>\n    <th ng-if="result.snippet" class="text-center">&nbsp;{{::result.snippet.match}}&nbsp;</th>\n    <td ng-if="result.snippet" ng-bind-html="result.snippet.after" class="text-left"></td>\n    <td ng-if="!result.snippet" colspan="3">{{::result.label}}</td>\n    <td ng-repeat="metadata in result.metadata">&nbsp;{{::metadata}}</td>\n  </tr>\n</table>')}])}(),function(e){try{e=angular.module("app")}catch(t){e=angular.module("app",[])}e.run(["$templateCache",function(e){e.put("partials/textsearchview.html",'\n<div class="form-group">\n  <label>Search</label>\n  <input ng-model="query" ng-model-options="{ debounce: 300 }" ng-keyup="$event.keyCode == 13 &amp;&amp; setConstraint()" class="form-control"/>\n</div>\n<ul infinite-scroll="scrollInstances()" infinite-scroll-parent="infinite-scroll-parent" infinite-scroll-distance="5" class="list-unstyled">\n  <li ng-repeat="keyword in keywords" ng-click="setConstraint(keyword.keyword,$event.ctrlKey||$event.metaKey)" ng-class="{selected:constraints[keyword.keyword]}" class="item"> <span>{{::keyword.keyword}}</span><span class="item-count pull-right">{{keyword.matchingInstances}}<span ng-show="keyword.totalInstances!=keyword.matchingInstances">/{{::keyword.totalInstances}}</span></span></li>\n</ul>')}])}(),function(e){try{e=angular.module("app")}catch(t){e=angular.module("app",[])}e.run(["$templateCache",function(e){e.put("partials/treeview.html",'\n<script type="text/ng-template" id="treenode.html"><span>{{node.label}}</span><span class="pull-right">{{node.matchingInstances}}/{{node.instances}}</span>\n  <ul class="list-unstyled">\n    <li ng-repeat="node in node.children" ng-include="\'treenode.html\'" ng-click="selectElement(node,$event.ctrlKey);$event.stopPropagation()" ng-class="{selected:isSelected(node)}" class="item"></li>\n  </ul>\n</script>\n<ul class="list-unstyled">\n  <li ng-repeat="node in tree" ng-include="\'treenode.html\'" ng-click="selectElement(node,$event.ctrlKey);$event.stopPropagation()" ng-class="{selected:isSelected(node)}" class="item"></li>\n</ul>')}])}();